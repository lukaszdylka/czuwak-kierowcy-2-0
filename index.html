<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Czuwak Kierowcy 2.0</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkN6dXdhayBLaWVyb3djeSAyLjAiLAogICJzaG9ydF9uYW1lIjogIkN6dXdhayIsCiAgImRlc2NyaXB0aW9uIjogIkFwbGlrYWNqYSBkbGEga2llcm93Y8OzdyBqZcW8ZHrEhWN5Y2ggbm9jxIUiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAiZnVsbHNjcmVlbiIsCiAgInRoZW1lX2NvbG9yIjogIiMxYTFhMWEiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMxYTFhMWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSmhkWFJ2SWlCb1pXbG5hSFE5SW1GMWRHOGlJSFpwWlhkQ2IzZzlJakFnTUNBek1pQXpNaUlnWm1sc2JEMGlJelJpTkdSbVppSTZQSEpsWTNRZ2VEMGlOaUlnZVQwaU5pSWdkMmxrZEdnOUlqSXdJaUJvWldsbmFIUTlJakl3SWlCbWFXeHNQU0lqWXpReVl6UWlMejQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMzJ4MzIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <meta name="theme-color" content="#1a1a1a">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
            user-select: none;
            -webkit-user-select: none;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .speed-display {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .status-text {
            font-size: 14px;
            color: #cccccc;
        }

        .interval-selector {
            margin-bottom: 20px;
        }

        .interval-selector label {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .interval-selector select {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            appearance: none;
        }

        .auto-start-section {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .vibration-section {
            background: rgba(156, 39, 176, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(156, 39, 176, 0.3);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-container label {
            font-size: 14px;
            cursor: pointer;
            margin: 0;
        }

        .speed-threshold {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .speed-threshold input[type="number"] {
            width: 80px;
            padding: 8px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            text-align: center;
            margin: 0 10px;
        }

        .speed-threshold span {
            font-size: 14px;
            color: #cccccc;
        }

        .control-buttons {
            margin-bottom: 30px;
        }

        .btn {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-start {
            background: #4CAF50;
            color: white;
        }

        .btn-stop {
            background: #f44336;
            color: white;
        }

        .btn-pause {
            background: #ff9800;
            color: white;
        }

        .alert-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #ff1744, #ff5574);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
        }

        .alert-section.hidden {
            display: none;
        }

        .alert-content {
            text-align: center;
            pointer-events: none; /* Treść nie przejmuje kliknięć */
        }

        .countdown {
            font-size: 72px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: countdown-pulse 1s infinite;
        }

        @keyframes countdown-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .alert-text {
            font-size: 32px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(0,0,0,0.5);
            animation: text-glow 2s infinite;
        }

        @keyframes text-glow {
            0%, 100% { text-shadow: 0 0 15px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 25px rgba(255,255,255,0.8); }
        }

        .tap-instruction {
            font-size: 24px;
            color: #ffffff;
            opacity: 0.9;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            animation: pulse-gentle 3s infinite;
        }

        @keyframes pulse-gentle {
            0%, 100% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .alarm-flash {
            animation: flash 0.3s infinite;
        }

        @keyframes flash {
            0%, 40% { 
                background: linear-gradient(135deg, #ff1744, #ff5574);
                color: #ffffff;
            }
            41%, 100% { 
                background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
                color: #ffffff;
            }
        }

        .hidden {
            display: none;
        }

        .next-alert {
            text-align: center;
            font-size: 14px;
            color: #888;
            margin-top: 20px;
        }

        .gps-status {
            font-size: 12px;
            color: #888;
            text-align: center;
            margin-top: 10px;
        }

        .vehicle-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-top: 10px;
        }

        .vehicle-moving {
            background: #4CAF50;
            color: white;
        }

        /* === MOBILE OPTIMIZATIONS === */
        
        /* Większe przyciski na telefonie */
        @media (max-width: 480px) {
            .btn {
                padding: 25px;
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .interval-selector select {
                padding: 18px;
                font-size: 18px;
            }
            
            .speed-threshold input[type="number"] {
                padding: 12px;
                font-size: 18px;
                width: 90px;
            }
            
            .countdown {
                font-size: 84px;
            }
            
            .alert-text {
                font-size: 36px;
            }
            
            .tap-instruction {
                font-size: 28px;
            }
        }

        /* Bardzo małe ekrany */
        @media (max-width: 360px) {
            .container {
                padding: 15px;
            }
            
            .btn {
                padding: 20px;
                font-size: 18px;
            }
            
            .countdown {
                font-size: 72px;
            }
        }

        /* Orientacja landscape na telefonie */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                max-width: 90%;
                padding: 10px;
            }
            
            .header {
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 20px;
                margin-bottom: 5px;
            }
            
            .status-bar, .auto-start-section, .vibration-section {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .btn {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .countdown {
                font-size: 48px;
                margin-bottom: 15px;
            }
            
            .alert-text {
                font-size: 24px;
            }
            
            .tap-instruction {
                font-size: 18px;
            }
        }

        /* Folded phones / narrow screens */
        @media (max-width: 280px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .btn {
                padding: 18px;
                font-size: 16px;
            }
            
            .speed-threshold {
                flex-direction: column;
                text-align: center;
            }
            
            .speed-threshold input[type="number"] {
                margin: 10px 0;
            }
        }

        /* Touch improvements */
        .btn, .checkbox-container, .interval-selector select, 
        .speed-threshold input[type="number"], .alert-section {
            touch-action: manipulation; /* Eliminuje delay na dotyk */
        }

        .btn:active, .alert-section:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }

        /* Prevent zoom on inputs - iOS */
        input[type="number"], select {
            font-size: 16px !important;
        }

        /* Better checkbox on mobile */
        @media (max-width: 480px) {
            .checkbox-container input[type="checkbox"] {
                width: 24px;
                height: 24px;
                margin-right: 15px;
            }
            
            .checkbox-container label {
                font-size: 16px;
            }
        }

        /* Gesture swipe area for alert dismissal */
        .swipe-hint {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            text-align: center;
            animation: swipe-animation 3s infinite;
        }

        @keyframes swipe-animation {
            0%, 100% { opacity: 0.8; transform: translateX(-50%) translateY(0); }
            50% { opacity: 1; transform: translateX(-50%) translateY(-10px); }
        }

        /* High contrast for poor lighting */
        @media (prefers-contrast: high) {
            .alert-section {
                background: linear-gradient(135deg, #ff0000, #ff3333);
            }
            
            .countdown, .alert-text, .tap-instruction {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            }
        }

        /* === NAVIGATION TABS === */
        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: transparent;
            border: none;
            color: #cccccc;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: #4CAF50;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* === TAB CONTENT === */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* === STATISTICS STYLES === */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #cccccc;
            text-transform: uppercase;
        }

        .session-stats {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .session-title {
            font-size: 16px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 15px;
            text-align: center;
        }

        .total-stats {
            background: rgba(156, 39, 176, 0.1);
            border: 1px solid rgba(156, 39, 176, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .total-title {
            font-size: 16px;
            font-weight: bold;
            color: #9C27B0;
            margin-bottom: 15px;
            text-align: center;
        }

        .clear-stats {
            width: 100%;
            padding: 10px;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            border-radius: 8px;
            color: #f44336;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
        }

        .clear-stats:hover {
            background: rgba(244, 67, 54, 0.3);
        }

        .reaction-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }

        .reaction-excellent { background: #4CAF50; color: white; }
        .reaction-good { background: #8BC34A; color: white; }
        .reaction-ok { background: #FF9800; color: white; }
        .reaction-slow { background: #f44336; color: white; }

        /* Reduce motion for sensitive users */
        @media (prefers-reduced-motion: reduce) {
            .countdown, .alert-text, .tap-instruction {
                animation: none;
            }
            
            .btn:active, .alert-section:active {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Czuwak Kierowcy 2.0</h1>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" id="mainTab">Główne</button>
            <button class="nav-tab" id="statsTab">Statystyki</button>
        </div>

        <!-- Main Tab Content -->
        <div class="tab-content active" id="mainContent">

        <div class="status-bar">
            <div class="speed-display">
                <span id="speed">-- km/h</span>
                <div class="vehicle-status hidden" id="vehicleStatus">
                    <span id="vehicleStatusText">Sprawdzanie GPS...</span>
                </div>
            </div>
            <div class="status-text" id="statusText">Nieaktywny</div>
            <div class="gps-status" id="gpsStatus">GPS: Sprawdzanie...</div>
        </div>

        <div class="interval-selector">
            <label for="interval">Interwał przypomnień:</label>
            <select id="interval">
                <option value="30">30 sekund</option>
                <option value="60" selected>1 minuta</option>
                <option value="120">2 minuty</option>
                <option value="300">5 minut</option>
                <option value="600">10 minut</option>
            </select>
        </div>

        <div class="auto-start-section">
            <div class="checkbox-container">
                <input type="checkbox" id="autoStartEnabled">
                <label for="autoStartEnabled">Auto-start przy spadku prędkości</label>
            </div>
            <div class="speed-threshold">
                <span>Uruchom gdy prędkość spadnie poniżej:</span>
                <input type="number" id="speedThreshold" value="120" min="50" max="200" step="10">
                <span>km/h</span>
            </div>
        </div>

        <div class="vibration-section">
            <div class="checkbox-container">
                <input type="checkbox" id="vibrationsEnabled">
                <label for="vibrationsEnabled">Wibracje podczas alarmu</label>
            </div>
            <div style="font-size: 12px; color: #888; margin-top: 5px; text-align: center;" id="vibrationStatus">
                Sprawdzanie obsługi wibracji...
            </div>
        </div>

        <div class="control-buttons">
            <button class="btn btn-start" id="startBtn">Rozpocznij</button>
            <button class="btn btn-pause hidden" id="pauseBtn">Zatrzymaj</button>
            <button class="btn btn-stop hidden" id="stopBtn">Zakończ</button>
        </div>

        <div class="alert-section hidden" id="alertSection">
            <div class="alert-content">
                <div class="countdown" id="countdown">15</div>
                <div class="alert-text">CZUWAM!</div>
                <div class="tap-instruction">DOTKNIJ GDZIEKOLWIEK</div>
                <div class="swipe-hint">lub przesuń palcem</div>
            </div>
        </div>

        <div class="next-alert" id="nextAlert"></div>

        </div>
        <!-- End Main Tab Content -->

        <!-- Statistics Tab Content -->
        <div class="tab-content" id="statsContent">
            
            <div class="session-stats">
                <div class="session-title">Bieżąca sesja</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="sessionDuration">0:00</div>
                        <div class="stat-label">Czas jazdy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sessionAlerts">0</div>
                        <div class="stat-label">Alerty</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sessionReactions">0</div>
                        <div class="stat-label">Reakcje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sessionSuccess">100%</div>
                        <div class="stat-label">Skuteczność</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <strong>Średni czas reakcji:</strong> 
                    <span id="avgReactionTime">-</span>
                    <span id="reactionQuality"></span>
                </div>
            </div>

            <div class="total-stats">
                <div class="total-title">Statystyki ogółem</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalSessions">0</div>
                        <div class="stat-label">Sesji</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTime">0:00</div>
                        <div class="stat-label">Całkowity czas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalReactions">0</div>
                        <div class="stat-label">Reakcji</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bestStreak">0</div>
                        <div class="stat-label">Najlepsza seria</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <strong>Ostatnia sesja:</strong> <span id="lastSessionDate">-</span>
                </div>
            </div>

            <button class="clear-stats" id="clearStatsBtn">Wyczyść wszystkie statystyki</button>
            
        </div>
        <!-- End Statistics Tab Content -->

        <audio id="alarmSound" loop preload="auto">
            <source src="alarm.mp3" type="audio/mpeg">
            <source src="alarm.wav" type="audio/wav">
            <source src="alarm.ogg" type="audio/ogg">
        </audio>
    </div>

    <script>
        class CzuwakKierowcy {
            constructor() {
                this.isActive = false;
                this.isPaused = false;
                this.interval = 60;
                this.alertTimer = null;
                this.countdownTimer = null;
                this.nextAlertTimer = null;
                this.wakeLock = null;
                this.geolocationWatcher = null;
                this.currentSpeed = 0;
                this.isVehicleMoving = false;
                this.lastPosition = null;
                this.autoStartEnabled = false;
                this.speedThreshold = 120;
                this.wasAboveThreshold = false;
                this.vibrationsEnabled = false;
                
                // Mobile optimization
                this.touchStartY = 0;
                this.touchStartX = 0;
                
                // Statistics
                this.sessionStartTime = null;
                this.sessionAlerts = 0;
                this.sessionReactions = 0;
                this.sessionMissed = 0;
                this.reactionTimes = [];
                this.currentStreak = 0;
                this.statsUpdateInterval = null;
                
                this.initElements();
                this.initEventListeners();
                this.initGeolocation();
                this.requestWakeLock();
                this.createAlarmSound();
                this.initMobileOptimizations();
                this.loadStatistics();
                this.checkVibrationSupport();
            }

            initElements() {
                this.intervalSelect = document.getElementById('interval');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.alertSection = document.getElementById('alertSection');
                this.countdown = document.getElementById('countdown');
                this.statusText = document.getElementById('statusText');
                this.speedDisplay = document.getElementById('speed');
                this.gpsStatus = document.getElementById('gpsStatus');
                this.vehicleStatus = document.getElementById('vehicleStatus');
                this.vehicleStatusText = document.getElementById('vehicleStatusText');
                this.nextAlert = document.getElementById('nextAlert');
                this.alarmSound = document.getElementById('alarmSound');
                this.autoStartCheckbox = document.getElementById('autoStartEnabled');
                this.speedThresholdInput = document.getElementById('speedThreshold');
                this.vibrationsCheckbox = document.getElementById('vibrationsEnabled');
                
                // Navigation tabs
                this.mainTab = document.getElementById('mainTab');
                this.statsTab = document.getElementById('statsTab');
                this.mainContent = document.getElementById('mainContent');
                this.statsContent = document.getElementById('statsContent');
                
                // Statistics elements
                this.sessionDuration = document.getElementById('sessionDuration');
                this.sessionAlerts = document.getElementById('sessionAlerts');
                this.sessionReactions = document.getElementById('sessionReactions');
                this.sessionSuccess = document.getElementById('sessionSuccess');
                this.avgReactionTime = document.getElementById('avgReactionTime');
                this.reactionQuality = document.getElementById('reactionQuality');
                this.totalSessions = document.getElementById('totalSessions');
                this.totalTime = document.getElementById('totalTime');
                this.totalReactions = document.getElementById('totalReactions');
                this.bestStreak = document.getElementById('bestStreak');
                this.lastSessionDate = document.getElementById('lastSessionDate');
                this.clearStatsBtn = document.getElementById('clearStatsBtn');
                this.vibrationStatus = document.getElementById('vibrationStatus');
            }

            createAlarmSound() {
                // Próbujemy użyć zewnętrznego pliku audio NAJPIERW
                this.useExternalAudio = false;
                
                this.alarmSound.addEventListener('loadeddata', () => {
                    console.log('Własny plik alarm.mp3 załadowany pomyślnie!');
                    this.useExternalAudio = true;
                });

                this.alarmSound.addEventListener('error', () => {
                    console.log('Nie można załadować alarm.mp3, używam syntetycznego dźwięku');
                    this.useExternalAudio = false;
                });

                // Załaduj plik
                this.alarmSound.load();
                
                // Przygotuj zapasowy syntetyczny dźwięk
                this.createSyntheticAlarm();
            }

            createSyntheticAlarm() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    this.createAlarmBuffer = () => {
                        const sampleRate = audioContext.sampleRate;
                        const duration = 1.0;
                        const buffer = audioContext.createBuffer(1, sampleRate * duration, sampleRate);
                        const data = buffer.getChannelData(0);
                        
                        for (let i = 0; i < data.length; i++) {
                            const time = i / sampleRate;
                            const frequency = 800 + 400 * Math.sin(2 * Math.PI * 2 * time);
                            data[i] = 0.3 * Math.sin(2 * Math.PI * frequency * time);
                        }
                        
                        return buffer;
                    };

                    this.alarmBuffer = this.createAlarmBuffer();
                    this.alarmSource = null;
                    console.log('Syntetyczny dźwięk przygotowany jako backup');
                } catch (error) {
                    console.log('Web Audio API nie jest dostępne');
                }
            }

            playAlarm() {
                // Wibracje jeśli włączone
                if (this.vibrationsEnabled) {
                    this.triggerVibration();
                }

                // NAJPIERW próbuj odtworzyć TWÓJ plik alarm.mp3
                if (this.useExternalAudio && this.alarmSound) {
                    try {
                        this.alarmSound.currentTime = 0;
                        this.alarmSound.volume = 1.0;
                        const playPromise = this.alarmSound.play();
                        
                        if (playPromise !== undefined) {
                            playPromise.then(() => {
                                console.log('Odtwarzam Twój plik alarm.mp3');
                            }).catch(error => {
                                console.log('Błąd odtwarzania alarm.mp3, przełączam na syntetyczny');
                                this.playSyntheticAlarm();
                            });
                        }
                    } catch (error) {
                        console.log('Błąd odtwarzania alarm.mp3, przełączam na syntetyczny');
                        this.playSyntheticAlarm();
                    }
                } else {
                    // Użyj syntetycznego dźwięku jako backup
                    console.log('Używam syntetycznego dźwięku (backup)');
                    this.playSyntheticAlarm();
                }
                
                document.body.classList.add('alarm-flash');
            }

            playSyntheticAlarm() {
                try {
                    if (this.alarmSource) {
                        this.alarmSource.stop();
                    }
                    
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.alarmSource = audioContext.createBufferSource();
                    this.alarmSource.buffer = this.alarmBuffer;
                    this.alarmSource.loop = true;
                    this.alarmSource.connect(audioContext.destination);
                    this.alarmSource.start();
                    console.log('Odtwarzam syntetyczny alarm');
                } catch (error) {
                    console.log('Nie można odtworzyć żadnego dźwięku');
                }
            }

            triggerVibration() {
                if (!this.vibrationsEnabled) return;
                
                if ('vibrate' in navigator) {
                    try {
                        // Intensywny wzór wibracji dla alarmu: długo-krótko-długo-krótko-bardzo długo
                        const success = navigator.vibrate([800, 200, 800, 200, 1500]);
                        console.log('Wibracje uruchomione:', success);
                        
                        // Dodatkowe wibracje co 3 sekundy podczas alarmu
                        this.vibrationInterval = setInterval(() => {
                            if (this.isActive && !this.alertSection.classList.contains('hidden')) {
                                navigator.vibrate([500, 100, 500]);
                            } else {
                                this.stopVibration();
                            }
                        }, 3000);
                        
                    } catch (error) {
                        console.log('Błąd wibracji:', error);
                    }
                } else {
                    console.log('Wibracje nie są obsługiwane w tej przeglądarce');
                }
            }

            stopVibration() {
                if (this.vibrationInterval) {
                    clearInterval(this.vibrationInterval);
                    this.vibrationInterval = null;
                }
                
                // Zatrzymaj wszystkie wibracje
                if ('vibrate' in navigator) {
                    navigator.vibrate(0);
                }
            }

            testVibration() {
                if ('vibrate' in navigator) {
                    try {
                        // Krótki test wibracji przy włączeniu opcji
                        const success = navigator.vibrate([200, 100, 200]);
                        console.log('Test wibracji:', success);
                        
                        if (success) {
                            this.vibrationStatus.textContent = 'Wibracje działają';
                            this.vibrationStatus.style.color = '#4CAF50';
                        } else {
                            this.vibrationStatus.textContent = 'Wibracje mogą nie działać';
                            this.vibrationStatus.style.color = '#ff9800';
                        }
                    } catch (error) {
                        this.vibrationStatus.textContent = 'Błąd wibracji';
                        this.vibrationStatus.style.color = '#f44336';
                    }
                } else {
                    this.vibrationStatus.textContent = 'Brak obsługi wibracji';
                    this.vibrationStatus.style.color = '#f44336';
                }
            }

            checkVibrationSupport() {
                const userAgent = navigator.userAgent;
                const isIOS = /iPad|iPhone|iPod/.test(userAgent);
                const isAndroid = /Android/.test(userAgent);
                const isDesktop = !isIOS && !isAndroid;

                if ('vibrate' in navigator) {
                    if (isIOS) {
                        this.vibrationStatus.textContent = 'iOS - wibracje mogą nie działać w przeglądarce';
                        this.vibrationStatus.style.color = '#ff9800';
                    } else if (isAndroid) {
                        this.vibrationStatus.textContent = 'Android - wibracje powinny działać';
                        this.vibrationStatus.style.color = '#4CAF50';
                    } else if (isDesktop) {
                        this.vibrationStatus.textContent = 'Desktop - brak wibracji';
                        this.vibrationStatus.style.color = '#888';
                        this.vibrationsCheckbox.disabled = true;
                    } else {
                        this.vibrationStatus.textContent = 'Nieznane urządzenie - sprawdź test';
                        this.vibrationStatus.style.color = '#888';
                    }
                } else {
                    this.vibrationStatus.textContent = 'Przeglądarka nie obsługuje wibracji';
                    this.vibrationStatus.style.color = '#f44336';
                    this.vibrationsCheckbox.disabled = true;
                }

                console.log('Obsługa wibracji:', {
                    hasVibrate: 'vibrate' in navigator,
                    userAgent: userAgent,
                    isIOS: isIOS,
                    isAndroid: isAndroid,
                    isDesktop: isDesktop
                });
            }

            stopAlarm() {
                // Zatrzymaj TWÓJ plik audio
                if (this.alarmSound) {
                    this.alarmSound.pause();
                    this.alarmSound.currentTime = 0;
                }
                
                // Zatrzymaj syntetyczny dźwięk
                if (this.alarmSource) {
                    try {
                        this.alarmSource.stop();
                    } catch (error) {
                        // Źródło już zatrzymane
                    }
                    this.alarmSource = null;
                }

                // Zatrzymaj wibracje
                this.stopVibration();
                
                document.body.classList.remove('alarm-flash');
            }

            initEventListeners() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.togglePause());
                this.stopBtn.addEventListener('click', () => this.stop());
                
                // Całoekranowy alert - kliknięcie gdziekolwiek
                this.alertSection.addEventListener('click', () => this.dismissAlert());
                this.alertSection.addEventListener('touchstart', (e) => {
                    this.touchStartY = e.touches[0].clientY;
                    this.touchStartX = e.touches[0].clientX;
                });
                this.alertSection.addEventListener('touchend', (e) => this.handleTouchEnd(e));
                
                // Zapobieganie przypadkowym gestom
                this.alertSection.addEventListener('touchmove', (e) => {
                    e.preventDefault(); // Zapobiega przewijaniu podczas alertu
                });

                // Navigation tabs
                this.mainTab.addEventListener('click', () => this.switchTab('main'));
                this.statsTab.addEventListener('click', () => this.switchTab('stats'));
                
                // Statistics
                this.clearStatsBtn.addEventListener('click', () => this.clearAllStats());
                
                this.intervalSelect.addEventListener('change', (e) => {
                    this.interval = parseInt(e.target.value);
                });

                this.autoStartCheckbox.addEventListener('change', (e) => {
                    this.autoStartEnabled = e.target.checked;
                    if (this.autoStartEnabled) {
                        this.statusText.textContent = 'Gotowy do auto-startu';
                    } else if (!this.isActive) {
                        this.statusText.textContent = 'Nieaktywny';
                    }
                });

                this.speedThresholdInput.addEventListener('change', (e) => {
                    this.speedThreshold = parseInt(e.target.value);
                });

                this.vibrationsCheckbox.addEventListener('change', (e) => {
                    this.vibrationsEnabled = e.target.checked;
                    if (this.vibrationsEnabled) {
                        // Test wibracji przy włączeniu
                        this.testVibration();
                    }
                });

                // Prevent screen lock
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && this.isActive) {
                        this.requestWakeLock();
                    }
                });
            }

            async requestWakeLock() {
                try {
                    if ('wakeLock' in navigator) {
                        this.wakeLock = await navigator.wakeLock.request('screen');
                    }
                } catch (err) {
                    console.log('Wake Lock API not supported');
                }
            }

            initGeolocation() {
                if ('geolocation' in navigator) {
                    this.geolocationWatcher = navigator.geolocation.watchPosition(
                        (position) => this.updateLocation(position),
                        (error) => this.handleGeolocationError(error),
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 5000 }
                    );
                } else {
                    this.gpsStatus.textContent = 'GPS: Niedostępny';
                }
            }

            updateLocation(position) {
                const { latitude, longitude, speed } = position.coords;
                
                // Prędkość w m/s, konwertujemy na km/h
                let speedKmh = 0;
                if (speed !== null && speed >= 0) {
                    speedKmh = Math.round(speed * 3.6);
                } else if (this.lastPosition) {
                    // Obliczamy prędkość na podstawie zmiany pozycji
                    const distance = this.calculateDistance(
                        this.lastPosition.latitude, this.lastPosition.longitude,
                        latitude, longitude
                    );
                    const timeDiff = (position.timestamp - this.lastPosition.timestamp) / 1000;
                    if (timeDiff > 0) {
                        speedKmh = Math.round((distance / timeDiff) * 3.6);
                    }
                }

                this.currentSpeed = Math.max(0, speedKmh);
                this.speedDisplay.textContent = `${this.currentSpeed} km/h`;
                
                this.isVehicleMoving = this.currentSpeed >= 1;
                this.updateVehicleStatus();
                
                // Sprawdź auto-start
                this.checkAutoStart();
                
                this.lastPosition = {
                    latitude,
                    longitude,
                    timestamp: position.timestamp
                };

                this.gpsStatus.textContent = 'GPS: Aktywny';
            }

            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371000; // Promień Ziemi w metrach
                const dLat = this.toRadians(lat2 - lat1);
                const dLon = this.toRadians(lon2 - lon1);
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                        Math.cos(this.toRadians(lat1)) * Math.cos(this.toRadians(lat2)) *
                        Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            toRadians(degrees) {
                return degrees * (Math.PI / 180);
            }

            updateVehicleStatus() {
                if (this.isVehicleMoving) {
                    this.vehicleStatusText.textContent = 'Jadę';
                    this.vehicleStatus.className = 'vehicle-status vehicle-moving';
                } else {
                    this.vehicleStatusText.textContent = 'Stoję';
                    this.vehicleStatus.className = 'vehicle-status vehicle-stopped';
                }
                this.vehicleStatus.classList.remove('hidden');
            }

            handleGeolocationError(error) {
                this.gpsStatus.textContent = `GPS: Błąd (${error.message})`;
            }

            checkAutoStart() {
                if (!this.autoStartEnabled || this.isActive) {
                    return;
                }

                // Sprawdź czy prędkość była wcześniej powyżej progu
                if (this.currentSpeed >= this.speedThreshold) {
                    this.wasAboveThreshold = true;
                    this.statusText.textContent = `Gotowy - Prędkość: ${this.currentSpeed} km/h`;
                    return;
                }

                // Jeśli prędkość spadła poniżej progu i wcześniej była powyżej
                if (this.wasAboveThreshold && this.currentSpeed < this.speedThreshold && this.currentSpeed > 10) {
                    this.statusText.textContent = `AUTO-START! Prędkość spadła do ${this.currentSpeed} km/h`;
                    setTimeout(() => {
                        this.start();
                    }, 2000); // 2 sekundy opóźnienia na przygotowanie
                }
            }

            start() {
                this.isActive = true;
                this.isPaused = false;
                this.wasAboveThreshold = false; // Reset auto-start
                
                // Reset session statistics
                this.sessionStartTime = Date.now();
                this.sessionAlerts = 0;
                this.sessionReactions = 0;
                this.sessionMissed = 0;
                this.reactionTimes = [];
                this.currentStreak = 0;
                this.alertStartTime = null;
                
                this.startBtn.classList.add('hidden');
                this.pauseBtn.classList.remove('hidden');
                this.stopBtn.classList.remove('hidden');
                this.statusText.textContent = 'Aktywny - Monitorowanie';
                
                // Start statistics update interval
                this.statsUpdateInterval = setInterval(() => this.updateSessionStats(), 1000);
                
                this.scheduleNextAlert();
            }

            stop() {
                this.isActive = false;
                this.isPaused = false;
                this.wasAboveThreshold = false; // Reset auto-start
                this.clearAllTimers();
                this.stopAlarm();
                this.hideAlert();
                
                // Stop statistics updates and save session
                if (this.statsUpdateInterval) {
                    clearInterval(this.statsUpdateInterval);
                    this.statsUpdateInterval = null;
                }
                this.saveSessionStats();
                
                this.startBtn.classList.remove('hidden');
                this.pauseBtn.classList.add('hidden');
                this.stopBtn.classList.add('hidden');
                
                if (this.autoStartEnabled) {
                    this.statusText.textContent = 'Gotowy do auto-startu';
                } else {
                    this.statusText.textContent = 'Nieaktywny';
                }
                this.nextAlert.textContent = '';
            }

            togglePause() {
                if (this.isPaused) {
                    this.isPaused = false;
                    this.pauseBtn.textContent = '⏸️ Zatrzymaj';
                    this.statusText.textContent = 'Aktywny - Monitorowanie';
                    this.scheduleNextAlert();
                } else {
                    this.isPaused = true;
                    this.pauseBtn.textContent = '▶️ Wznów';
                    this.statusText.textContent = 'Wstrzymany';
                    this.clearAllTimers();
                    this.nextAlert.textContent = '';
                }
            }

            scheduleNextAlert() {
                if (!this.isActive || this.isPaused) return;

                // Sprawdź czy pojazd się porusza
                if (!this.isVehicleMoving && this.currentSpeed < 1) {
                    this.statusText.textContent = 'Wstrzymany - Pojazd stoi';
                    // Sprawdź ponownie za 5 sekund
                    this.nextAlertTimer = setTimeout(() => this.scheduleNextAlert(), 5000);
                    return;
                }

                this.statusText.textContent = 'Aktywny - Monitorowanie';
                const nextAlertTime = new Date(Date.now() + this.interval * 1000);
                this.updateNextAlertDisplay(nextAlertTime);

                this.alertTimer = setTimeout(() => {
                    this.showAlert();
                }, this.interval * 1000);
            }

            updateNextAlertDisplay(nextTime) {
                const updateDisplay = () => {
                    if (!this.isActive || this.isPaused) {
                        this.nextAlert.textContent = '';
                        return;
                    }

                    const now = new Date();
                    const diff = Math.max(0, Math.ceil((nextTime - now) / 1000));
                    
                    if (diff > 0) {
                        const minutes = Math.floor(diff / 60);
                        const seconds = diff % 60;
                        this.nextAlert.textContent = `Następne przypomnienie za: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                        setTimeout(updateDisplay, 1000);
                    } else {
                        this.nextAlert.textContent = '';
                    }
                };
                updateDisplay();
            }

            showAlert() {
                this.alertSection.classList.remove('hidden');
                // Scroll na górę i zablokuj przewijanie
                document.body.style.overflow = 'hidden';
                window.scrollTo(0, 0);
                
                this.sessionAlerts++;
                this.alertStartTime = Date.now();
                this.startCountdown();
            }

            hideAlert() {
                this.alertSection.classList.add('hidden');
                // Przywróć przewijanie
                document.body.style.overflow = 'auto';
                this.clearCountdown();
            }

            startCountdown() {
                let timeLeft = 15;
                this.countdown.textContent = timeLeft;

                this.countdownTimer = setInterval(() => {
                    timeLeft--;
                    this.countdown.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        this.triggerAlarm();
                    }
                }, 1000);
            }

            clearCountdown() {
                if (this.countdownTimer) {
                    clearInterval(this.countdownTimer);
                    this.countdownTimer = null;
                }
            }

            triggerAlarm() {
                this.clearCountdown();
                this.playAlarm();
                this.statusText.textContent = 'ALARM! Kliknij przycisk!';
                this.sessionMissed++;
                this.currentStreak = 0; // Reset streak na missed alert
            }

            dismissAlert() {
                const reactionTime = this.alertStartTime ? Date.now() - this.alertStartTime : 0;
                this.sessionReactions++;
                this.reactionTimes.push(reactionTime);
                this.currentStreak++;
                
                this.hideAlert();
                this.stopAlarm();
                this.statusText.textContent = 'Aktywny - Monitorowanie';
                this.scheduleNextAlert();
                console.log(`Alert dismissed - reakcja w ${reactionTime}ms`);
            }

            handleTouchEnd(e) {
                const touchEndY = e.changedTouches[0].clientY;
                const touchEndX = e.changedTouches[0].clientX;
                
                // Sprawdź czy to było zwykłe dotknięcie czy swipe
                const deltaY = Math.abs(touchEndY - this.touchStartY);
                const deltaX = Math.abs(touchEndX - this.touchStartX);
                
                // Jeśli ruch był minimalny (zwykłe dotknięcie) lub znaczny swipe
                if ((deltaY < 50 && deltaX < 50) || deltaY > 100 || deltaX > 100) {
                    this.dismissAlert();
                }
            }

            initMobileOptimizations() {
                // Wykryj orientację i dostosuj UI
                this.handleOrientationChange();
                
                // Nasłuchuj zmiany orientacji
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.handleOrientationChange(), 200);
                });
                
                // Nasłuchuj zmiany rozmiaru okna
                window.addEventListener('resize', () => {
                    this.handleResize();
                });
                
                // Dodaj meta tag dla lepszej obsługi viewport (jeśli nie ma)
                this.ensureViewportMeta();
                
                // Wykryj czy to urządzenie mobilne
                this.detectMobileDevice();
            }

            handleOrientationChange() {
                const orientation = window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';
                document.body.setAttribute('data-orientation', orientation);
                
                if (orientation === 'landscape' && window.innerHeight < 500) {
                    document.body.classList.add('landscape-mobile');
                } else {
                    document.body.classList.remove('landscape-mobile');
                }
                
                console.log('Orientacja:', orientation);
            }

            handleResize() {
                // Dostosuj UI do nowego rozmiaru
                if (this.isActive && !this.alertSection.classList.contains('hidden')) {
                    // Jeśli alert jest aktywny, upewnij się że zajmuje cały ekran
                    this.alertSection.style.height = window.innerHeight + 'px';
                }
            }

            ensureViewportMeta() {
                let viewport = document.querySelector('meta[name="viewport"]');
                if (!viewport) {
                    viewport = document.createElement('meta');
                    viewport.name = 'viewport';
                    viewport.content = 'width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0';
                    document.head.appendChild(viewport);
                }
            }

            detectMobileDevice() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                if (isMobile || isTouchDevice) {
                    document.body.classList.add('mobile-device');
                    console.log('Urządzenie mobilne wykryte');
                } else {
                    document.body.classList.add('desktop-device');
                    console.log('Urządzenie desktop wykryte');
                }
            }

            // === STATISTICS FUNCTIONS ===
            
            switchTab(tab) {
                if (tab === 'main') {
                    this.mainTab.classList.add('active');
                    this.statsTab.classList.remove('active');
                    this.mainContent.classList.add('active');
                    this.statsContent.classList.remove('active');
                } else if (tab === 'stats') {
                    this.mainTab.classList.remove('active');
                    this.statsTab.classList.add('active');
                    this.mainContent.classList.remove('active');
                    this.statsContent.classList.add('active');
                    this.updateAllStats(); // Refresh stats when viewing
                }
            }

            updateSessionStats() {
                if (!this.sessionStartTime) return;

                const duration = Date.now() - this.sessionStartTime;
                const minutes = Math.floor(duration / 60000);
                const seconds = Math.floor((duration % 60000) / 1000);
                
                this.sessionDuration.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                this.sessionAlerts.textContent = this.sessionAlerts;
                this.sessionReactions.textContent = this.sessionReactions;
                
                // Calculate success rate
                const total = this.sessionReactions + this.sessionMissed;
                const successRate = total > 0 ? Math.round((this.sessionReactions / total) * 100) : 100;
                this.sessionSuccess.textContent = `${successRate}%`;
                
                // Calculate average reaction time
                if (this.reactionTimes.length > 0) {
                    const avgTime = this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length;
                    const avgSeconds = (avgTime / 1000).toFixed(1);
                    this.avgReactionTime.textContent = `${avgSeconds}s`;
                    
                    // Quality indicator
                    let quality = '';
                    if (avgTime < 3000) quality = '<span class="reaction-excellent">Doskonały!</span>';
                    else if (avgTime < 5000) quality = '<span class="reaction-good">Dobry</span>';
                    else if (avgTime < 8000) quality = '<span class="reaction-ok">W porządku</span>';
                    else quality = '<span class="reaction-slow">Wolny</span>';
                    
                    this.reactionQuality.innerHTML = quality;
                } else {
                    this.avgReactionTime.textContent = '-';
                    this.reactionQuality.innerHTML = '';
                }
            }

            saveSessionStats() {
                if (!this.sessionStartTime) return;

                const stats = this.loadStoredStats();
                const sessionDuration = Date.now() - this.sessionStartTime;
                
                // Update totals
                stats.totalSessions++;
                stats.totalTime += sessionDuration;
                stats.totalReactions += this.sessionReactions;
                
                // Update best streak
                if (this.currentStreak > stats.bestStreak) {
                    stats.bestStreak = this.currentStreak;
                }
                
                stats.lastSessionDate = new Date().toLocaleDateString('pl-PL');
                
                // Save to localStorage
                try {
                    localStorage.setItem('czuwak_stats', JSON.stringify(stats));
                    console.log('Statystyki sesji zapisane');
                } catch (error) {
                    console.log('Błąd zapisywania statystyk');
                }
            }

            loadStatistics() {
                this.updateAllStats();
            }

            loadStoredStats() {
                try {
                    const stored = localStorage.getItem('czuwak_stats');
                    if (stored) {
                        return JSON.parse(stored);
                    }
                } catch (error) {
                    console.log('Błąd odczytywania statystyk');
                }
                
                // Default stats
                return {
                    totalSessions: 0,
                    totalTime: 0,
                    totalReactions: 0,
                    bestStreak: 0,
                    lastSessionDate: '-'
                };
            }

            updateAllStats() {
                // Update session stats
                this.updateSessionStats();
                
                // Update total stats
                const stats = this.loadStoredStats();
                
                this.totalSessions.textContent = stats.totalSessions;
                
                // Format total time
                const totalMinutes = Math.floor(stats.totalTime / 60000);
                const totalHours = Math.floor(totalMinutes / 60);
                const remainingMinutes = totalMinutes % 60;
                
                if (totalHours > 0) {
                    this.totalTime.textContent = `${totalHours}h ${remainingMinutes}m`;
                } else {
                    this.totalTime.textContent = `${totalMinutes}m`;
                }
                
                this.totalReactions.textContent = stats.totalReactions;
                this.bestStreak.textContent = stats.bestStreak;
                this.lastSessionDate.textContent = stats.lastSessionDate;
            }

            clearAllStats() {
                if (confirm('Czy na pewno chcesz wyczyścić wszystkie statystyki?\n\nTej operacji nie można cofnąć.')) {
                    try {
                        localStorage.removeItem('czuwak_stats');
                        
                        // Reset session stats
                        this.sessionAlerts = 0;
                        this.sessionReactions = 0;
                        this.sessionMissed = 0;
                        this.reactionTimes = [];
                        this.currentStreak = 0;
                        
                        this.updateAllStats();
                        console.log('Wszystkie statystyki wyczyszczone');
                        
                        alert('Statystyki zostały wyczyszczone!');
                    } catch (error) {
                        alert('Błąd podczas czyszczenia statystyk');
                    }
                }
            }

            clearAllTimers() {
                if (this.alertTimer) {
                    clearTimeout(this.alertTimer);
                    this.alertTimer = null;
                }
                if (this.nextAlertTimer) {
                    clearTimeout(this.nextAlertTimer);
                    this.nextAlertTimer = null;
                }
                this.clearCountdown();
            }
        }

        // Inicjalizacja aplikacji
        document.addEventListener('DOMContentLoaded', () => {
            new CzuwakKierowcy();
        });

        // Service Worker dla PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChzZWxmLnNraXBXYWl0aW5nKCkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBldmVudCA9PiB7CiAgZXZlbnQucmVzcG9uZFdpdGgoCiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgIHJldHVybiByZXNwb25zZSB8fCBmZXRjaChldmVudC5yZXF1ZXN0KTsKICAgIH0pCiAgKTsKfSk7')
              .then(() => console.log('Service Worker zarejestrowany'))
              .catch(err => console.log('Service Worker błąd:', err));
        }
    </script>
</body>
</html>
